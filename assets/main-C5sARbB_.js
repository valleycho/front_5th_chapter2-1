import"./modulepreload-polyfill-B5Qt9EMX.js";const p=1e3,$=10*p,b=20*p,q=30*p,v=60*p,m=Math.random();function o(t,e){return Object.assign(document.createElement(t),e)}const r={products:[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],getProducts(){return this.products},getFindProduct(t){return this.products.find(e=>e.id===t)}},c={selectedProduct:void 0,discountRate:0,setSelectedProduct(t){this.selectedProduct=t},getSelectedProduct(){return this.selectedProduct},setDiscountRate(t){this.discountRate=t},getDiscountRate(){return this.discountRate}},E={$element:null,render(){const t=o("button",{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가"});return this.$element=t,this.$element.addEventListener("click",()=>this.handleAddCartButtonClick()),this.$element},getElement(){return this.$element},handleAddCartButtonClick(){const t=h.getElement().value,e=r.getFindProduct(t);if(!(((e==null?void 0:e.quantity)??0)>0)){alert("재고가 부족합니다.");return}const i=document.getElementById(e.id);if(i){const s=parseInt(i.querySelector("span").textContent.split("x ")[1])+1;i.querySelector("span").textContent=`${e.name} - ${e.price}원 x ${s}`,e.quantity--}else y.addNewCartItem(e),e.quantity--;g(),c.setSelectedProduct(t)}},P=o("div",{className:"bg-gray-100 p-8"}),f=o("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"}),R=o("h1",{className:"text-2xl font-bold mb-4",textContent:"장바구니"}),x={$element:null,render(){const t=o("div",{id:"stock-status",className:"text-sm text-gray-500 mt-2"});return this.$element=t,this.$element},getElement(){return this.$element},updateStockStatus(){const t=r.getProducts();let e="";const n=5;t.forEach(i=>{if(i.quantity<n){const a=i.quantity===0;e=`${i.name}: ${a?"품절":"재고 부족 ("+i.quantity+"개 남음)"}`}}),this.$element.textContent=e}},h={$element:null,render(){const t=o("select",{id:"product-select",className:"border rounded p-2 mr-2"});return this.$element=t,this.updateOptionElement(),this.$element},getElement(){return this.$element},updateOptionElement(){this.$element.innerHTML="",r.getProducts().forEach(e=>{const n=o("option",{value:e.id,textContent:`${e.name} - ${e.price}원`});e.quantity===0&&(n.disabled=!0),this.$element.appendChild(n)})}},y={$element:null,render(){const t=o("div",{id:"cart-items"});return this.$element=t,this.$element.addEventListener("click",e=>this.handleCartItemsClick(e)),this.$element},getElement(){return this.$element},addNewCartItem(t){const e=o("div",{id:t.id,className:"flex justify-between items-center mb-2",innerHTML:`
            <span>${t.name} - ${t.price}원 x 1</span>
            <div>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="-1">-</button>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="1">+</button>
                <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t.id}">삭제</button>
            </div>
        `});this.$element.appendChild(e)},removeCartItem(t,e){const n=parseInt(t.querySelector("span").textContent.split("x ")[1]);e.quantity+=n,t.remove()},changeCartItemQuantity(t,e,n){let i=parseInt(t.dataset.change),s=parseInt(e.querySelector("span").textContent.split("x ")[1])+i;s>0&&s<=n.quantity+parseInt(e.querySelector("span").textContent.split("x ")[1])?(e.querySelector("span").textContent=e.querySelector("span").textContent.split("x ")[0]+"x "+s,n.quantity-=i):s<=0?(e.remove(),n.quantity-=i):alert("재고가 부족합니다.")},handleCartItemsClick(t){const e=t.target,n=e.dataset.productId,i=r.getFindProduct(n),s=document.getElementById(n);e.classList.contains("quantity-change")&&this.changeCartItemQuantity(e,s,i),e.classList.contains("remove-item")&&this.removeCartItem(s,i),g()}},l={$element:null,render(){const t=o("div",{id:"cart-total",className:"text-xl font-bold my-4"});return this.$element=t,this.$element},getElement(){return this.$element},updateCartTotal(t){this.$element.textContent=`총액: ${t}원`},updateCartDiscount(){const e=(c.getDiscountRate()*100).toFixed(1),n=o("span",{className:"text-green-500 ml-2",textContent:`(${e}% 할인 적용)`});this.$element.appendChild(n)},updateCartPoint(t){const e=Math.floor(t/1e3);let n=document.getElementById("loyalty-points");n||(n=o("span",{id:"loyalty-points",className:"text-blue-500 ml-2"}),this.$element.appendChild(n)),n.textContent=`(포인트: ${e})`},calculateCartTotal(t){const e=r.getProducts();let n=y.getElement().children;for(let i=0;i<n.length;i++){let s;for(let d=0;d<e.length;d++)if(e[d].id===n[i].id){s=e[d];break}let a=parseInt(n[i].querySelector("span").textContent.split("x ")[1]),u=s.price*a,C=0;a>=10&&(C=w(s.id)),t.itemQuantity+=a,t.subTotalPrice+=u,t.totalPrice+=u*(1-C)}}};function D(){setTimeout(()=>{setInterval(()=>{const i=r.getProducts(),s=i[Math.floor(m*i.length)];if(m<.3&&s.quantity>0){const u=Math.round(s.price*.8);s.price=u,alert(`번개세일! ${s.name}이(가) 20% 할인 중입니다!`),h.updateOptionElement()}},q)},m*$)}function I(){setTimeout(()=>{setInterval(()=>{const n=r.getProducts(),i=c.getSelectedProduct();if(i){const s=n.find(a=>a.id!==i&&a.quantity>0);if(s){alert(`${s.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`);const a=Math.round(s.price*.95);s.price=a,i.updateOptionElement()}}},v)},m*b)}function S(){D(),I()}function w(t){return t==="p1"?.1:t==="p2"?.15:t==="p3"?.2:t==="p4"?.05:t==="p5"?.25:0}function Q(t){if(t.itemQuantity>=30){const i=t.totalPrice*.25,s=t.subTotalPrice-t.totalPrice;i>s?(t.totalPrice=t.subTotalPrice*(1-.25),c.setDiscountRate(.25)):t.setDiscountRate((t.subTotalPrice-t.totalPrice)/t.subTotalPrice)}else c.setDiscountRate((t.subTotalPrice-t.totalPrice)/t.subTotalPrice)}function k(t){const e=new Date().getDay()===2,n=.1;e&&(t.totalPrice*=1-n,c.setDiscountRate(Math.max(c.getDiscountRate(),n)))}function g(){const t={itemQuantity:0,totalPrice:0,subTotalPrice:0};l.calculateCartTotal(t),Q(t),k(t),l.updateCartTotal(t.totalPrice),c.getDiscountRate()>0&&l.updateCartDiscount(),x.updateStockStatus(),l.updateCartPoint(t.totalPrice)}function T(){const t=document.getElementById("app"),e=[R,y.render(),l.render(),h.render(),E.render(),x.render()];f.append(...e),P.appendChild(f),t.appendChild(P)}function N(){T(),S(),g()}N();
