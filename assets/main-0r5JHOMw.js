import"./modulepreload-polyfill-B5Qt9EMX.js";const m=1e3,b=10*m,P=20*m,q=30*m,v=60*m,d=Math.random();function a(t,e){return Object.assign(document.createElement(t),e)}const c={products:[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],getProducts(){return this.products},getFindProduct(t){return this.products.find(e=>e.id===t)}},g={selectedProduct:void 0,setSelectedProduct(t){this.selectedProduct=t},getSelectedProduct(){return this.selectedProduct}},E={$element:null,render(){const t=a("button",{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가"});return this.$element=t,this.$element.addEventListener("click",()=>this.handleAddCartButtonClick()),this.$element},getElement(){return this.$element},handleAddCartButtonClick(){const t=p.getElement().value,e=c.getFindProduct(t);if(!(((e==null?void 0:e.quantity)??0)>0)){alert("재고가 부족합니다.");return}const s=document.getElementById(e.id);if(s){const o=parseInt(s.querySelector("span").textContent.split("x ")[1])+1;s.querySelector("span").textContent=`${e.name} - ${e.price}원 x ${o}`,e.quantity--}else y.addNewCartItem(e),e.quantity--;h(),g.setSelectedProduct(t)}},f=a("div",{className:"bg-gray-100 p-8"}),x=a("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"}),I=a("h1",{className:"text-2xl font-bold mb-4",textContent:"장바구니"}),$={$element:null,render(){const t=a("div",{id:"stock-status",className:"text-sm text-gray-500 mt-2"});return this.$element=t,this.$element},getElement(){return this.$element},updateStockStatus(){const t=c.getProducts();let e="";const n=5;t.forEach(s=>{if(s.quantity<n){const i=s.quantity===0;e=`${s.name}: ${i?"품절":"재고 부족 ("+s.quantity+"개 남음)"}`}}),this.$element.textContent=e}},p={$element:null,render(){const t=a("select",{id:"product-select",className:"border rounded p-2 mr-2"});return this.$element=t,this.updateOptionElement(),this.$element},getElement(){return this.$element},updateOptionElement(){this.$element.innerHTML="",c.getProducts().forEach(e=>{const n=a("option",{value:e.id,textContent:`${e.name} - ${e.price}원`});e.quantity===0&&(n.disabled=!0),this.$element.appendChild(n)})}},y={$element:null,render(){const t=a("div",{id:"cart-items"});return this.$element=t,this.$element.addEventListener("click",e=>this.handleCartItemsClick(e)),this.$element},getElement(){return this.$element},addNewCartItem(t){const e=a("div",{id:t.id,className:"flex justify-between items-center mb-2",innerHTML:`
            <span>${t.name} - ${t.price}원 x 1</span>
            <div>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="-1">-</button>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="1">+</button>
                <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t.id}">삭제</button>
            </div>
        `});this.$element.appendChild(e)},removeCartItem(t,e){const n=parseInt(t.querySelector("span").textContent.split("x ")[1]);e.quantity+=n,t.remove()},changeCartItemQuantity(t,e,n){let s=parseInt(t.dataset.change),o=parseInt(e.querySelector("span").textContent.split("x ")[1])+s;o>0&&o<=n.quantity+parseInt(e.querySelector("span").textContent.split("x ")[1])?(e.querySelector("span").textContent=e.querySelector("span").textContent.split("x ")[0]+"x "+o,n.quantity-=s):o<=0?(e.remove(),n.quantity-=s):alert("재고가 부족합니다.")},handleCartItemsClick(t){const e=t.target,n=e.dataset.productId,s=c.getFindProduct(n),o=document.getElementById(n);e.classList.contains("quantity-change")&&this.changeCartItemQuantity(e,o,s),e.classList.contains("remove-item")&&this.removeCartItem(o,s),h()}},l={$element:null,render(){const t=a("div",{id:"cart-total",className:"text-xl font-bold my-4"});return this.$element=t,this.$element},getElement(){return this.$element},updateCartTotal(t){this.$element.textContent=`총액: ${t}원`},updateCartDiscount(t){const e=(t*100).toFixed(1),n=a("span",{className:"text-green-500 ml-2",textContent:`(${e}% 할인 적용)`});this.$element.appendChild(n)},updateCartPoint(t){const e=Math.floor(t/1e3);let n=document.getElementById("loyalty-points");n||(n=a("span",{id:"loyalty-points",className:"text-blue-500 ml-2"}),this.$element.appendChild(n)),n.textContent=`(포인트: ${e})`},calculateCartTotal(t){const e=c.getProducts();let n=y.getElement().children;for(let s=0;s<n.length;s++){let o;for(let r=0;r<e.length;r++)if(e[r].id===n[s].id){o=e[r];break}let i=parseInt(n[s].querySelector("span").textContent.split("x ")[1]),u=o.price*i,C=0;i>=10&&(C=D(o.id)),t.cartItemQuantity+=i,t.subTot+=u,t.cartTotalAmount+=u*(1-C)}}};function T(){setTimeout(()=>{setInterval(()=>{const s=c.getProducts(),o=s[Math.floor(d*s.length)];if(d<.3&&o.quantity>0){const u=Math.round(o.price*.8);o.price=u,alert(`번개세일! ${o.name}이(가) 20% 할인 중입니다!`),p.updateOptionElement()}},q)},d*b)}function R(){setTimeout(()=>{setInterval(()=>{const n=c.getProducts(),s=g.getSelectedProduct();if(s){const o=n.find(i=>i.id!==s&&i.quantity>0);if(o){alert(`${o.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`);const i=Math.round(o.price*.95);o.price=i,s.updateOptionElement()}}},v)},d*P)}function S(){T(),R()}function D(t){return t==="p1"?.1:t==="p2"?.15:t==="p3"?.2:t==="p4"?.05:t==="p5"?.25:0}function w(t){if(t.cartItemQuantity>=30){const s=t.cartTotalAmount*.25,o=t.subTot-t.cartTotalAmount;s>o?(t.cartTotalAmount=t.subTot*(1-.25),t.discountRate=.25):t.discountRate=(t.subTot-t.cartTotalAmount)/t.subTot}else t.discountRate=(t.subTot-t.cartTotalAmount)/t.subTot}function Q(t){const e=new Date().getDay()===2,n=.1;e&&(t.cartTotalAmount*=1-n,t.discountRate=Math.max(t.discountRate,n))}function h(){const t={discountRate:0,cartItemQuantity:0,cartTotalAmount:0,subTot:0};l.calculateCartTotal(t),w(t),Q(t),l.updateCartTotal(t.cartTotalAmount),t.discountRate>0&&l.updateCartDiscount(t.discountRate),$.updateStockStatus(),l.updateCartPoint(t.cartTotalAmount)}function k(){const t=document.getElementById("app"),e=[I,y.render(),l.render(),p.render(),E.render(),$.render()];x.append(...e),f.appendChild(x),t.appendChild(f)}function A(){k(),S(),h()}A();
