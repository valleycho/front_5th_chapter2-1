import"./modulepreload-polyfill-B5Qt9EMX.js";const p=1e3,f=10*p,x=20*p,$=30*p,b=60*p,m=Math.random();function o(t,e){return Object.assign(document.createElement(t),e)}const r={products:[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],getProducts(){return this.products},getFindProduct(t){return this.products.find(e=>e.id===t)}},n={selectedProduct:void 0,discountRate:0,state:{itemQuantity:0,totalPrice:0,subTotalPrice:0},setSelectedProduct(t){this.selectedProduct=t},getSelectedProduct(){return this.selectedProduct},setDiscountRate(t){this.discountRate=t},getDiscountRate(){return this.discountRate},setState(t){this.state=t},getState(){return this.state},resetCartState(){this.state={itemQuantity:0,totalPrice:0,subTotalPrice:0}}},q={$element:null,render(){const t=o("button",{id:"add-to-cart",className:"bg-blue-500 text-white px-4 py-2 rounded",textContent:"추가"});return this.$element=t,this.$element.addEventListener("click",()=>this.handleAddCartButtonClick()),this.$element},getElement(){return this.$element},handleAddCartButtonClick(){const t=h.getElement().value,e=r.getFindProduct(t);if(!(((e==null?void 0:e.quantity)??0)>0)){alert("재고가 부족합니다.");return}const a=document.getElementById(e.id);if(a){const s=parseInt(a.querySelector("span").textContent.split("x ")[1])+1;a.querySelector("span").textContent=`${e.name} - ${e.price}원 x ${s}`,e.quantity--}else y.addNewCartItem(e),e.quantity--;g(),n.setSelectedProduct(t)}},S=o("div",{className:"bg-gray-100 p-8"}),P=o("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"}),v=o("h1",{className:"text-2xl font-bold mb-4",textContent:"장바구니"}),C={$element:null,render(){const t=o("div",{id:"stock-status",className:"text-sm text-gray-500 mt-2"});return this.$element=t,this.$element},getElement(){return this.$element},updateStockStatus(){const t=r.getProducts();let e="";const i=5;t.forEach(a=>{if(a.quantity<i){const c=a.quantity===0;e=`${a.name}: ${c?"품절":"재고 부족 ("+a.quantity+"개 남음)"}`}}),this.$element.textContent=e}},h={$element:null,render(){const t=o("select",{id:"product-select",className:"border rounded p-2 mr-2"});return this.$element=t,this.updateOptionElement(),this.$element},getElement(){return this.$element},updateOptionElement(){this.$element.innerHTML="",r.getProducts().forEach(e=>{const i=o("option",{value:e.id,textContent:`${e.name} - ${e.price}원`});e.quantity===0&&(i.disabled=!0),this.$element.appendChild(i)})}},y={$element:null,render(){const t=o("div",{id:"cart-items"});return this.$element=t,this.$element.addEventListener("click",e=>this.handleCartItemsClick(e)),this.$element},getElement(){return this.$element},addNewCartItem(t){const e=o("div",{id:t.id,className:"flex justify-between items-center mb-2",innerHTML:`
            <span>${t.name} - ${t.price}원 x 1</span>
            <div>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="-1">-</button>
                <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t.id}" data-change="1">+</button>
                <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t.id}">삭제</button>
            </div>
        `});this.$element.appendChild(e)},removeCartItem(t,e){const i=parseInt(t.querySelector("span").textContent.split("x ")[1]);e.quantity+=i,t.remove()},changeCartItemQuantity(t,e,i){let a=parseInt(t.dataset.change),s=parseInt(e.querySelector("span").textContent.split("x ")[1])+a;s>0&&s<=i.quantity+parseInt(e.querySelector("span").textContent.split("x ")[1])?(e.querySelector("span").textContent=e.querySelector("span").textContent.split("x ")[0]+"x "+s,i.quantity-=a):s<=0?(e.remove(),i.quantity-=a):alert("재고가 부족합니다.")},handleCartItemsClick(t){const e=t.target,i=e.dataset.productId,a=r.getFindProduct(i),s=document.getElementById(i);e.classList.contains("quantity-change")&&this.changeCartItemQuantity(e,s,a),e.classList.contains("remove-item")&&this.removeCartItem(s,a),g()}},l={$element:null,render(){const t=o("div",{id:"cart-total",className:"text-xl font-bold my-4"});return this.$element=t,this.$element},getElement(){return this.$element},updateCartTotal(){this.$element.textContent=`총액: ${n.getState().totalPrice}원`},updateCartDiscount(){const e=(n.getDiscountRate()*100).toFixed(1),i=o("span",{className:"text-green-500 ml-2",textContent:`(${e}% 할인 적용)`});this.$element.appendChild(i)},updateCartPoint(){const t=Math.floor(n.getState().totalPrice/1e3);let e=document.getElementById("loyalty-points");e||(e=o("span",{id:"loyalty-points",className:"text-blue-500 ml-2"}),this.$element.appendChild(e)),e.textContent=`(포인트: ${t})`},calculateCartTotal(){const t=r.getProducts();let e=y.getElement().children;for(let i=0;i<e.length;i++){let a;for(let d=0;d<t.length;d++)if(t[d].id===e[i].id){a=t[d];break}let s=parseInt(e[i].querySelector("span").textContent.split("x ")[1]),c=a.price*s,u=0;s>=10&&(u=I(a.id)),n.setState({itemQuantity:n.getState().itemQuantity+s,subTotalPrice:n.getState().subTotalPrice+c,totalPrice:n.getState().totalPrice+c*(1-u)})}}};function E(){setTimeout(()=>{setInterval(()=>{const a=r.getProducts(),s=a[Math.floor(m*a.length)];if(m<.3&&s.quantity>0){const u=Math.round(s.price*.8);s.price=u,alert(`번개세일! ${s.name}이(가) 20% 할인 중입니다!`),h.updateOptionElement()}},$)},m*f)}function R(){setTimeout(()=>{setInterval(()=>{const i=r.getProducts(),a=n.getSelectedProduct();if(a){const s=i.find(c=>c.id!==a&&c.quantity>0);if(s){alert(`${s.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`);const c=Math.round(s.price*.95);s.price=c,a.updateOptionElement()}}},b)},m*x)}function D(){E(),R()}function I(t){return t==="p1"?.1:t==="p2"?.15:t==="p3"?.2:t==="p4"?.05:t==="p5"?.25:0}function Q(){if(n.getState().itemQuantity>=30){const i=n.getState().totalPrice*.25,a=n.getState().subTotalPrice-n.getState().totalPrice;i>a?(n.setState({...n.getState(),totalPrice:n.getState().subTotalPrice*(1-.25)}),n.setDiscountRate(.25)):n.setDiscountRate((n.getState().subTotalPrice-n.getState().totalPrice)/n.getState().subTotalPrice)}else n.setDiscountRate((n.getState().subTotalPrice-n.getState().totalPrice)/n.getState().subTotalPrice)}function w(){const t=new Date().getDay()===2,e=.1;t&&(n.setState({...n.getState(),totalPrice:n.getState().totalPrice*(1-e)}),n.setDiscountRate(Math.max(n.getDiscountRate(),e)))}function g(){n.resetCartState(),l.calculateCartTotal(),Q(),w(),l.updateCartTotal(),n.getDiscountRate()>0&&l.updateCartDiscount(),C.updateStockStatus(),l.updateCartPoint()}function k(){const t=document.getElementById("app"),e=[v,y.render(),l.render(),h.render(),q.render(),C.render()];P.append(...e),S.appendChild(P),t.appendChild(S)}function T(){k(),D(),g()}T();
